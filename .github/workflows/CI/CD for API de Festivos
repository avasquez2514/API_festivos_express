name: CI/CD for API de Festivos

on:
  push:
    branches:
      - main  # Esta es la rama que desencadenará el workflow

jobs:
  build-and-deploy:
    name: Build and Deploy API de Festivos
    runs-on: ubuntu-latest

    steps:
      # Paso 1: Hacer checkout del código
      - name: Checkout code
        uses: actions/checkout@v3

      # Paso 2: Configurar Docker Buildx
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v2

      # Paso 3: Crear la red de Docker si no existe
      - name: Create Docker network
        run: |
          docker network inspect redcalendario || docker network create redcalendario

      # Paso 4: Construir la imagen Docker para la API de Festivos
      - name: Build Docker image for API de Festivos
        run: |
          docker build -t apifestivos .

      # Paso 5: Ejecutar el contenedor
      - name: Run API de Festivos container
        run: |
          docker stop dockerapiapifestivos-master || true
          docker rm dockerapiapifestivos-master || true
          docker run --network redcalendario -d --name dockerapiapifestivos-master -p 3030:3030 apifestivos

      # Paso 6: Verificar que el contenedor está corriendo
      - name: Verify container is running
        run: |
          docker ps -a | grep dockerapiapifestivos-master


